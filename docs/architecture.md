# Архитектура системы

## Структура проекта

Приложение построено на FastAPI с PostgreSQL. Код разделен на слои по назначению:

```
app/
├── api/           # HTTP эндпоинты  
├── core/          # Конфигурация
├── crud/          # Операции с базой данных
├── db/            # Подключение к БД
├── models/        # SQLAlchemy модели
├── schemas/       # Pydantic схемы валидации
└── main.py        # Запуск приложения
```

## Слои приложения

### API слой (`app/api/`)
- `appointments.py` - REST эндпоинты для записей
- Обработка HTTP запросов/ответов  
- Валидация входных данных через Pydantic
- Обработка ошибок с правильными HTTP кодами

### Схемы (`app/schemas/`)
- `appointment.py` - Pydantic модели для валидации
- Проверка бизнес-правил (рабочие часы, дни, интервалы)
- Сериализация ответов API

### CRUD слой (`app/crud/`)
- `appointment.py` - операции с записями
- `doctor.py` - операции с врачами
- Бизнес-логика взаимодействия с БД
- Проверка уникальности и доступности

### Модели (`app/models/`)
- `appointment.py` - модель записи на прием
- `doctor.py` - модель врача
- SQLAlchemy ORM, связи между таблицами
- Индексы и ограничения

### База данных (`app/db/`)
- `database.py` - подключение к PostgreSQL
- Управление сессиями
- Dependency injection для FastAPI

### Конфигурация (`app/core/`)
- `settings.py` - настройки через переменные окружения
- Pydantic Settings для валидации конфига

## Поток обработки запроса

```
HTTP Request → API → Schemas (validation) → CRUD → Models → PostgreSQL
HTTP Response ← API ← Schemas (serialize) ← CRUD ← Models ← PostgreSQL
```

1. FastAPI принимает HTTP запрос
2. Pydantic валидирует данные по схеме
3. CRUD функция проверяет бизнес-правила
4. SQLAlchemy выполняет операцию с БД
5. Результат возвращается через те же слои

## Технологические решения

- **FastAPI** - автогенерация OpenAPI, встроенная валидация
- **PostgreSQL** - ACID транзакции, уникальные ограничения
- **SQLAlchemy 2.0** - async ORM с типизацией
- **Pydantic** - валидация данных и настроек
- **Docker** - контейнеризация для развертывания

## Обработка ошибок

- **422** - ошибки валидации Pydantic (неправильный формат данных)
- **400** - бизнес-ошибки (врач занят, не найден)
- **404** - запись не найдена
- **500** - ошибки базы данных или сервера 