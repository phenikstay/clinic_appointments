# Бизнес-процессы системы записи на прием

## Участники

### Пациент  
- Создает записи на прием через API
- Может просматривать свои записи
- Не может изменять или удалять записи

### Врач (концептуально)
- Может просматривать свое расписание  
- Может изменять статус приема
- Может отменять приемы

### Администратор (концептуально)
- Полный доступ ко всем операциям
- Управление врачами и их активностью  
- Мониторинг системы и логов
- Доступ к базе данных напрямую

## Бизнес-правила

### Временные ограничения
Реализованы в `app/schemas/appointment.py`:

- **Рабочие часы**: 9:00-17:30 (включительно)
- **Рабочие дни**: понедельник-пятница
- **Интервалы**: кратно 30 минутам (00 или 30 минут часа)
- **Время в будущем**: нельзя записаться на прошедшее время
- **Timezone**: обязательно указывать

### Ограничения целостности
Реализованы в `app/models/appointment.py` и `app/crud/`:

- **Уникальность**: (doctor_id, start_time) - один врач, одно время
- **Врач существует**: doctor_id должен быть в таблице doctors
- **Врач активен**: is_active = TRUE
- **Имя пациента**: не пустое, максимум 255 символов

## HTTP статус-коды

### 201 - Успешное создание
Запись создана в базе данных.

### 400 - Бизнес-ошибки
- "Врач не найден или неактивен"
- "Врач уже занят в это время"

### 404 - Запись не найдена
При GET запросе несуществующей записи.

### 422 - Ошибки валидации
Подробные сообщения от Pydantic:
- "Время записи должно быть в будущем"
- "Записи принимаются с 9:00 до 17:30"
- "Записи принимаются только в рабочие дни"
- "Запись возможна только в начале часа или в половину"
- "Timezone обязателен"

### 500 - Ошибки сервера
- "Произошла ошибка базы данных"
- "Внутренняя ошибка сервера"

## Основные сценарии

### Успешная запись
1. Пациент выбирает активного врача
2. Указывает время в рабочие часы
3. Время свободно
4. Запись создается (HTTP 201)

### Конфликт времени
1. Первый пациент успешно записывается
2. Второй пациент выбирает то же время
3. Получает ошибку "Врач уже занят" (HTTP 400)

### Неправильное время
1. Пациент указывает нерабочее время
2. Система возвращает ошибку валидации (HTTP 422)
3. Подробное сообщение о требованиях к времени

## Развитие системы

### Ближайшие задачи
- Уведомления пациентам
- Интеграция с календарем врачей
